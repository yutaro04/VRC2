generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id                Int                @id @default(autoincrement())
  description       String?
  nickname          String             @unique @db.VarChar(50)
  passwordHash      String?            @map("password_hash")
  email             String?            @unique
  createdAt         DateTime           @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt         DateTime           @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  deletedAt         DateTime?          @map("deleted_at") @db.Timestamptz(6)
  avatarUrl         String?            @map("avatar_url")
  supabaseAuthId    String?            @unique @map("supabase_auth_id")
  eventParticipants EventParticipant[]

  @@map("users")
}

model Device {
  id        Int       @id @default(autoincrement())
  name      String    @db.VarChar(20)
  createdAt DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt DateTime  @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  deletedAt DateTime? @map("deleted_at") @db.Timestamptz(6)
  events    Event[]

  @@map("devices")
}

model Event {
  id                 Int                @id @default(autoincrement())
  title              String             @db.VarChar(100)
  description        String?
  deviceId           Int                @map("device_id")
  maxParticipantsNum Int?               @map("max_participants_num")
  mainImageUrl       String             @map("main_image_url") @db.VarChar(100)
  deadline           DateTime?          @db.Timestamptz(6)
  createdAt          DateTime           @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt          DateTime           @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  deletedAt          DateTime?          @map("deleted_at") @db.Timestamptz(6)
  eventDates         EventDate[]
  eventParticipants  EventParticipant[]
  device             Device             @relation(fields: [deviceId], references: [id])

  @@map("events")
}

model EventDate {
  id        Int       @id @default(autoincrement())
  eventId   Int       @map("event_id")
  startDate DateTime  @map("start_date") @db.Timestamptz(6)
  endDate   DateTime  @map("end_date") @db.Timestamptz(6)
  createdAt DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt DateTime  @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  deletedAt DateTime? @map("deleted_at") @db.Timestamptz(6)
  event     Event     @relation(fields: [eventId], references: [id], onDelete: Cascade)

  @@map("event_date")
}

model EventParticipant {
  id        Int                @id @default(autoincrement())
  eventId   Int                @map("event_id")
  userId    Int                @map("user_id")
  role      String             @db.VarChar(20)
  status    participant_status @default(pending)
  appliedAt DateTime?          @default(now()) @map("applied_at") @db.Timestamptz(6)
  deletedAt DateTime?          @map("deleted_at") @db.Timestamptz(6)
  event     Event              @relation(fields: [eventId], references: [id], onDelete: Cascade)
  user      User               @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([eventId, userId])
  @@map("event_participants")
}

enum participant_status {
  pending
  approved
  rejected
  cancelled
}
